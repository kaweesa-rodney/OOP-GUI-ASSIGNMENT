{% extends "base_sidebar.html" %}

{% block title %}
Users
{% endblock %}

{% block content %}
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                {{ message|safe }}
            </div>
        {% endfor %}
    {% endif %}
    
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Users</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Register User</button>
        </li>
    </ul>

    <div class="tab-content mt-4" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="card">
        
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered first" style="width: 100%" id="mydatax">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>User Name</th>
                                    <th>Action</th>                                               
                                </tr>
                            </thead>
                            <tbody>
                                {% for usr in users %}
                                   
                                <tr>
                                    <td>{{ usr.email }}</td>
                                    <td>{{ usr.username }}</td>
                                    <td>
                                    {% if request.user.is_superuser %}
                                        <a class="btn btn-xs btn-info" href="">Change Password</a>&nbsp;&nbsp;
                                    {% endif %}
        
        
        
                                    {% if request.user.is_superuser %}
                                        {% if usr.is_active %}
                                        
                                            {% if usr.username == request.user.username and usr.id == request.user.id %}
                                                
                                                    <!--<a class="btn btn-xs btn-danger" href="{% url 'users:disable_user' usr.id %}" onclick="return confirm('Are you sure you want deactivate this user?')">Disable</a> -->
                                            
                                            {% elif usr.username != request.user.username %}
                                                
                                                    <a class="btn btn-xs btn-danger" href="{% url 'users:disable_user' usr.id %}" onclick="return confirm('Are you sure you want deactivate this user?')">Disable</a>
                                                
                                            {% endif %}
        
                                        {% else %}
                                            <a class="btn btn-xs btn-success" href="{% url 'users:activate_user' usr.id %}" onclick="return confirm('Are you sure you want activate this user?')">Activate</a>
                                        {% endif %}
                                    {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Email</th>
                                    <th>User Name</th>
                                    <th>Action</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="card">
                
                <div class="card-body">
                    <form method="post", action="{% url 'users:register_user' %}">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="Username">User Name:</label>
                            <input type="username" name="username" id="username" class="form-control" required>
                        </div>
                    
                        <div class="mb-3">
                            <label for="Email">Email:</label>
                            <input type="email" name="email" id="email" class="form-control" required>
                        </div>
                    
                        <div class="mb-3">
                            <label for="Password">Password:</label>
                            <input type="password" name="new_password2" id="new_password2" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label for="is_superuser">Superuser Status:</label>
                            <select name="is_superuser" id="is_superuser" class="form-control" required>
                                <option value="">---Select----</option>
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                    
                        <button type="submit" class="btn btn-primary w-100">Submit</button>
                    </form>
                </div>
            </div>
            
            
            {% for field in form %}
              {% for error in field.errors %}
                <div class="text-danger">{{ error }}</div>
              {% endfor %}
            {% endfor %}
        </div>
    </div>


    <script>
        $(document).ready(function(){
            var table = $("#mydatax").DataTable({
                "pageLength": 5,
                "dom": "Bfrtip",
                buttons: [],
                responsive: true,
            });
    
    
            $(document).on('click', '.delete_data', function(){
                return confirm('Are you sure you want to delete this record?');
            });
        });
    </script>
{% endblock %}